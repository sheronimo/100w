<style>
	.upcoming-events-grid {
		display: grid;
		grid-template-columns: repeat(3, 29.6%);
		column-gap: 5.5%;
		row-gap: 30px;
		align-items: flex-start;
	}

	.img-wrap {
		position: relative;
	}

	.upcoming-event-date {
		position: absolute;
		top: 1rem;
		right: 1.5rem;
		padding: 7px 15px;
		background-color: #f8cc55;
		font-size: 12px;
		line-height: 1em;
		text-transform: uppercase;
	}

	.upcoming-event-img {
		display: block;
		max-width: 100%;
		height: auto;
		border: 2px solid #fff;
	}

	.upcoming-event-text {
		padding: 20px;
		color: #ffffff;
		line-height: 1.2em;
		font-size: 16px;
	}

	.upcoming-event-title {
		color: #f8cc55 !important;
		font-size: 18px;
		line-height: 1.02em;
		padding-bottom: 10px;
	}

	.upcoming-event-block .img-wrap {
		cursor: pointer;
	}

	.js_event_date {
		font-family: 'Noto Sans SC', sans-serif;
		font-weight: 700;
	}

	.event-overlay {
		position: fixed;
		inset: 0;
		z-index: 999;
		display: none;
		animation: fadeIn 0.5s;
		background-color: rgba(0, 0, 0, 0.75);
		backdrop-filter: blur(2px);
	}

	.event-overlay.toggled {
		display: block;
		opacity: 1;
	}

	.event-modal {
		position: fixed;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		background-color: #fff;
		max-width: 500px;
		width: 90%;
		display: none;
		z-index: 1000;
		animation: fadeIn 0.5s;
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
		}
		to {
			opacity: 1;
		}
	}

	.event-modal.toggled {
		display: block;
	}

	.event-modal-img {
		width: 100%;
		height: auto;
		display: block;
	}

	.event-modal-body {
		padding: 20px;
	}

	.btn-close-modal {
		cursor: pointer;
		position: absolute;
		top: 0;
		right: 0;
		color: #333;
		background-color: #fff;
		font-size: 14px;
		border: none;
		padding-inline: 8px;
		padding-block: 6px;
		transform: scale(1);
		transition: transform 0.5s linear;
	}

	.btn-close-modal:hover {
		transform: scale(1.2);
	}

	@media (max-width: 992px) {
		.upcoming-events-grid {
			grid-template-columns: repeat(2, 47.25%);
			gap: 5.5%;
			row-gap: 30px;
		}

		.upcoming-event-title {
			font-size: 16px;
		}

		.upcoming-event-date {
			padding: 5px 10px;
			font-size: 9px;
		}
	}
</style>
<div class="upcoming-events-grid">
	[pods name="event" orderby="event_start_date ASC"
	where="((event_start_date.meta_value BETWEEN DATE_SUB(CURRENT_DATE, INTERVAL
	DAYOFMONTH(CURRENT_DATE)-1 DAY) AND DATE_ADD(CURRENT_DATE, INTERVAL 100 YEAR))
	AND (event_end_date.meta_value >= CURRENT_DATE())) OR
	((event_start_date.meta_value BETWEEN CURRENT_DATE() AND
	LAST_DAY(CURRENT_DATE)) AND (event_end_date.meta_value = '0000-00-00'))"]
	<div class="upcoming-event-block">
		<div class="img-wrap">
			<img class="upcoming-event-img" src="{@post_thumbnail_url.medium}" />
			<div class="upcoming-event-date">
				<span class="js_event_date">{@event_start_date}</span> [if
				event_end_date]-
				<span class="js_event_date">{@event_end_date}</span>[/if]
			</div>
		</div>
		<div class="upcoming-event-text">
			<h4 class="upcoming-event-title">{@post_title}</h4>
			<p>{@event_venue}</p>
		</div>
		<template class="modal-template">
			<div class="event-overlay"></div>
			<div class="event-modal">
				<button class="btn-close-modal">x</button>
				<img src="{@post_thumbnail_url.large}" class="event-modal-img" />
				<div class="event-modal-body">
					<p><strong> {@post_title}</strong></p>
					[if event_description] {@event_description}[/if]
				</div>
			</div>
		</template>
	</div>
	[/pods]
</div>
<script>
	const eventDateElements = document.querySelectorAll('.js_event_date');
	eventDateElements.forEach((d) => {
		let parsedDate = d.textContent.split('-');
		// Get the value directly through the object key, no looping needed
		let calcMonth = parsedDate[0];
		let calcDay = parsedDate[1];

		d.textContent = `${calcMonth}月${calcDay}日`;
	});

	const eventBlockImages = document.querySelectorAll(
		'.upcoming-event-block .img-wrap'
	);
	eventBlockImages.forEach((i) => {
		i.addEventListener('click', (e) => {
			e.preventDefault();
			e.stopPropagation();
			let closest = e.target.closest('.upcoming-event-block');
			let template = closest.querySelector('.modal-template');
			let clone = template.content.cloneNode(true);

			clone.querySelector('.event-overlay').classList.add('toggled');
			clone.querySelector('.event-modal').classList.add('toggled');

			document.body.appendChild(clone);
		});
	});

	window.addEventListener('click', (e) => {
		e.stopPropagation();
		let toggledModals = document.querySelector('.event-modal.toggled');
		if (toggledModals != null) {
			if (
				e.target == document.querySelector('.btn-close-modal') ||
				!e.target.closest('.event-modal.toggled')
			) {
				document.querySelector('.event-overlay.toggled').remove();
				document.querySelector('.event-modal.toggled').remove();
			}
		}
	});
</script>
